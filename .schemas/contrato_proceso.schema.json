{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Contrato de Proceso",
  "description": "Esquema para validar la estructura de un contrato de proceso.",
  "type": "object",
  "properties": {
    "id": {
      "description": "Identificador único y legible del proceso.",
      "type": "string",
      "pattern": "^[a-z0-9_\\-]+\\.[a-z0-9_\\-]+$"
    },
    "owner": {
      "description": "El equipo responsable del ciclo de vida de este proceso.",
      "type": "string"
    },
    "version": {
      "description": "Versión semántica (SemVer) del contrato.",
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
    },
    "purpose": {
      "description": "Una explicación concisa del valor de negocio que entrega este proceso.",
      "type": "string"
    },
    "sla": {
      "description": "Los Acuerdos de Nivel de Servicio que el proceso garantiza.",
      "type": "object",
      "properties": {
        "cycle_time_p95_minutes": {
          "type": "integer",
          "minimum": 0
        },
        "success_rate_target_pct": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        }
      },
      "required": ["cycle_time_p95_minutes", "success_rate_target_pct"]
    },
    "hitl": {
      "description": "Define los puntos de intervención Humano-en-el-Bucle (Human-in-the-Loop).",
      "type": "object",
      "properties": {
        "checkpoints": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {"type": "string"},
              "description": {"type": "string"}
            },
            "required": ["name", "description"]
          }
        },
        "escalation_rules": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "condition": {"type": "string"},
              "checkpoint": {"type": "string"}
            },
            "required": ["condition", "checkpoint"]
          }
        }
      },
      "required": ["checkpoints", "escalation_rules"]
    },
    "saga": {
      "description": "Define la lógica de compensación para procesos de larga duración (Patrón Saga).",
      "type": "object",
      "properties": {
        "steps": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {"type": "string"},
              "invoke": {"type": "string"},
              "compensate": {"type": "string"}
            },
            "required": ["name", "invoke"]
          }
        }
      },
      "required": ["steps"]
    },
    "events": {
      "description": "Declara los eventos de negocio que el proceso emite y consume.",
      "type": "object",
      "properties": {
        "emitted": {
          "type": "array",
          "items": {"type": "string"}
        },
        "consumed": {
          "type": "array",
          "items": {"type": "string"}
        }
      },
      "required": ["emitted", "consumed"]
    },
    "observability": {
      "description": "Define los Indicadores de Nivel de Servicio (SLIs) clave.",
      "type": "object",
      "properties": {
        "slis": {
          "type": "array",
          "items": {"type": "string"}
        }
      },
      "required": ["slis"]
    }
  },
  "required": ["id", "owner", "version", "purpose", "sla", "events", "observability"]
}
